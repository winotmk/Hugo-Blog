<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=12371&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Docker | ExampleSite</title>
<meta name=keywords content><meta name=description content="ExampleSite description"><meta name=author content="Me"><link rel=canonical href=http://localhost:12371/tags/docker/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.9de45e225101e4f99701d2b68fc6b8a1ef6027928be6391fa15bf7f56326c909.css integrity="sha256-neReIlEB5PmXAdK2j8a4oe9gJ5KL5jkfoVv39WMmyQk=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:12371/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:12371/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:12371/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:12371/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:12371/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=http://localhost:12371/tags/docker/index.xml><link rel=alternate hreflang=en href=http://localhost:12371/tags/docker/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="http://localhost:12371/tags/docker/"><meta property="og:site_name" content="ExampleSite"><meta property="og:title" content="Docker"><meta property="og:description" content="ExampleSite description"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="http://localhost:12371/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:12371/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Docker"><meta name=twitter:description content="ExampleSite description"></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:12371/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:12371/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:12371/categories/ title=categories><span>categories</span></a></li><li><a href=http://localhost:12371/tags/ title=tags><span>tags</span></a></li><li><a href=https://example.org title=example.org><span>example.org</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=http://localhost:12371/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:12371/tags/>Tags</a></div><h1>Docker
<a href=/tags/docker/index.xml title=RSS aria-label=RSS><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>calibre_web的pdf封面提取问题</h2></header><div class=entry-content><p>在用johngong/calibre-web:latest这个镜像 https://hub.docker.com/r/johngong/calibre-web 作为自己nas上的图书馆时发现pdf文件无法生成封面， 断断续续排查了两周，百思不得解，尝试过：
设置imagemagick的policy.xml文件(/etc/Imagemagick/policy.xml) 使用lscr.io/linuxserver/calibre-web:latest的镜像 自己重新构建镜像 重新安装calibre-web包和重装imagemagick包 都解决不了，总之是十分折腾，最后认为可能是johngong/calibre-web:latest可能是里少了一个imagemagick-pdf包 最终有效的解决方法的折腾流程 我尝试上传pdf文件，然后打开日志（日志级别设置为DEBUG） 查看文件：/config/calbre-web/calbre-web.log 有这么一行： [2024-09-25 12:10:22,144] WARN {cps.uploader:237} Cannot extract cover image, using default: no decode delegate for this image format `PDF' @ error/constitute.c/ReadImage/746
[2024-09-25 12:10:22,145] WARN {cps.uploader:238} On Windows this error could be caused by missing ghostscript PDF转就转不出来 所以找到了： https://github.com/ImageMagick/ImageMagick/issues/6148
apk add --no-cache imagemagick imagemagick-pdf 安装完以后，再次尝试上传pdf格式的书，就看见封面辣！！ johngong/calibre-web的一些设置 https://github.com/gshang2017/docker/issues/133 如果一编辑图书的元数据就卡死，可用尝试： 这两条设置为true,则 这里不会出现google等选项，家里的nas没有梯子环境，反而会导致卡死，所以禁用google吧。。也没啥用
弯路 这里想记一下这个弯路，在calibre-web的FAQ里赫然记着有关pdf文件转不出封面的解决办法，说要改 https://github.com/janeczku/calibre-web/wiki/FAQ#what-to-do-if-cover-pictures-are-not-extracted-from-pdf-files 所以可以有/etc/Imagemagick/policy.xml:
&lt;policymap>
&lt;policy domain="coder" rights="read | write" pattern="{MSVG,MVG,PS,PDF,RSVG,SVG,XPS}" />
&lt;/policymap> 这是最容易找到的一种解法，但我自己试了无用，没有上面的装apk add imagemagick-pdf好使
...</p></div><footer class=entry-footer>1 min&nbsp;·&nbsp;122 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to calibre_web的pdf封面提取问题" href=http://localhost:12371/posts/240925_calibre_web%E7%9A%84pdf%E5%B0%81%E9%9D%A2%E6%8F%90%E5%8F%96%E9%97%AE%E9%A2%98/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Docker01_用docker构建hexo和vsftpd与ddns镜像并且用阿里云容器服务ECI运行</h2></header><div class=entry-content><p>一口气步子迈得有大，慢慢记录一下,如果你碰巧看到这个文章，希望这个文章的某些部分对你有帮助，来源我已尽量在文章中标出，还有很多部分是自己敲的
了解ECI弹性容器：https://www.aliyun.com/product/eci 了解阿里云NAS文件存储：https://www.aliyun.com/product/nas
为什么要用eci来运行hexo？ 因为好玩，同时来学习从pull到发布到运行整个docker镜像的流程，也想给自己的hexo博客找个新家，酷酷的那种 本博客之前是由树莓派上的hexo生成，部署到github上的 最近在捣鼓docker，一时想不起来有什么灵活小巧的服务拿来用docker玩，那么想着干脆把树莓派上hexo这部分服务做成镜像，需要用的时候拿出来用用想必是极好的（这么一来好像树莓派又要吃灰了） 恰巧最近又在琢磨阿里云ECI容器服务，所以理论上是可以用我自己打包好的镜像的 最后成品的结构大致如下图：
这里挂了3个镜像： 1.node.js+git+ssh+hexo 主要是此镜像——由node.js+hexo组成的运行hexo环境，用过的都了解hexo是基于node.js的，每次我们生成文章的时候都会hexo g -d，而运行这套需要一个环境容器 git和ssh主要是部署在github上用的，同时我习惯用VSCode的SSH FS来管理远程文件和写博客，主要是ssh连接，也方便我拿PuTTY和WinSCP远程登录管理 2.vsftpd 一个常用的ftp服务，我是在本地些完再上传的，用这个是因为我发现如果要给文章插入图片，我还需要手动用ssh上传到hexo对应目录里。而用VSCode的SSH FS可以帮我自动同步本地工作目录和云上即将生成静态网页的hexo目录，非常方便！ 3.ddns 因为容器是即用即开，用完就释放的，每次开会新分配一个弹性IP做为外网接口，但是不想每次都去复制这个新的ip地址，那么就要用到动态域名解析，刚好我在阿里云上购买过一个我自己的域名，所以ddns这部分服务就拉出来做个镜像
还挂了一个NAS盘： 挂载以后： 可见我的hexo，主题，文章，图片等等都存放在里面，服务容器可以随便释放拉取，数据不会受到影响，几百M的NAS容量价格抹零后可以忽略不计
文章后面（第三部分）会说如何按我的需求构建定制这几个镜像，并上传到阿里云容器镜像ARK仓库以方便调用
vsftpd还有ddns可以与主镜像node.js+hexo合并成一个大镜像吗？ 当然可以，但我实际做了几次以后发现把ftp，ddns这样常用的服务功能单独拿出来会方便得多的多，毕竟我想起别得服务，也可以给他们挂上ftp等常用服务，我也可以选择不挂，这样容器的优势就体现出来了。我可以把单一的服务都做成单独的小镜像，需要哪个挂哪个，性能消耗也很小
整套下来有这些部分：
docker基本操作 已经启动的本地容器修改端口，启动容器时即启动服务等 打包制作自己的docker镜像(dockerfile) docker镜像打包并上传到阿里云镜像库ARK eci容器创建模板和eci命令行工具使用 hexo本地编辑环境设置————如何用VSCode舒服的写MD文档 附表： 群晖搭建私有镜像仓库和dockerengine设置 eci价格计算表
1. docker 基本操作 博主吐槽一下，总觉得一些类似run，commit操作完全可以做成一个美观好用的UI控制软件，但是docker destop就是不做，然后大家都默认敲命令行是方便的，好用的。十分不解，可能需要ui的不会写ui，熟练使用命令行的也不需要什么ui吧，诶 ——后面随着对docker了解的深入，明白它不是虚拟机，用得还是linux内核，这么一想，处处真是浓浓的linux味，现在能提供一个windows下的Docker Desktop桌面程序，已经非常得不错了！ 资料网站：
官方命令大全
基于Docker的Hexo博客搭建
这个基本操作写得还行下次爬一篇下来吧：
[小抄] Docker 基本命令
1.1 运行容器 docker run -it -d --name [container-name] -p 8088:80 [image-name] 这里是将容器内的80端口映射到宿主机的8088端口
...</p></div><footer class=entry-footer>8 min&nbsp;·&nbsp;1602 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to Docker01_用docker构建hexo和vsftpd与ddns镜像并且用阿里云容器服务ECI运行" href=http://localhost:12371/posts/docker01/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Linux和docker常用命令</h2></header><div class=entry-content><p>还是会有很多不常用的命令要来回查，仅记录，绝非完整命令参考
文件操作相关 复制目录 复制目录dir1和dir1目录下的文件到dir2目录里
cp -r dir1 dir2 安装lrzsz实现zmodem串口文件传输
rz 下载Zmodem
xz 上传Zmodem windterm下支持直接拖拽文件，但是也要安装lrzsz以支持命令 https://www.cnblogs.com/lidabo/p/4780866.html
挂载U盘 fdisk -l 可以看到一块14.84GB的SD卡，位置在/dev/sda1 使用
mount -t vfat /dev/sda1 /mnt 来挂载U盘 cd到/mnt即可看到U盘里的文件了，另外可以在/mnt里新建文件夹mkdir xxxxx，再挂载到文件夹里
卸载：
umount /mnt 打包压缩和解压 压缩
tar -czvf ***.tar.gz 解压
tar -xzvf ***.tar.gz docker https://yeasy.gitbook.io/docker_practice/container/run
启动docker:
sudo systemctl start docker 查看已有镜像：
docker ps -a 启动已终止容器:
docker container start 运行新的镜像run：
docker run -it -d --name hexo_debian -p 22:22 -p 4000:4000 -v XXX:/hexo/ hexo_debian:V02 save: 把本地镜像打包成tar方便带走
docker save -o jre8u342_ch.tar jre8u342_ch:latest 打包好的tar用的时候可以：
docker load -i {image_name}.tar
docker load --input {image_name}.tar 如果没有tag可以手动打tag~
...</p></div><footer class=entry-footer>1 min&nbsp;·&nbsp;212 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to Linux和docker常用命令" href=http://localhost:12371/posts/240619_linux%E5%91%BD%E4%BB%A4/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>用容器来运行streamlit</h2></header><div class=entry-content><p>一开始玩这个的时候就在想用docker跑，因为实在不想在本机里搭各种乱七八糟的环境，也懒得用Anaconda那样的中间环境，总感觉本地跑个模型才用得上那种大玩意儿，于是在dockerhub上找了找 一些已有的可用镜像： https://hub.docker.com/r/aminehy/docker-streamlit-app https://hub.docker.com/r/samdobson/streamlit 就是镜像build都好几年前了，实测目前有些新的例程都跑不了，还是自己做个镜像吧
制作dockerfile https://docs.streamlit.io/deploy/tutorials/docker 好在官网已给出方案 这是我微改后的：
# app/Dockerfile
FROM python:3.9-slim
WORKDIR /app
RUN apt-get update && apt-get install -y \
build-essential \
curl \
software-properties-common \
git \
&& rm -rf /var/lib/apt/lists/*
RUN git clone https://github.com/streamlit/streamlit-example.git .
RUN pip3 install -r requirements.txt
EXPOSE 8501
HEALTHCHECK CMD curl --fail http://localhost:8501/_stcore/health
CMD ["streamlit", "run", "main.py", "--server.port=8501", "--server.address=0.0.0.0"] 主要就最后一行并没有用ENTRYPOINT，因为记得这个不是必须，用CMD的好处是非常方便的就能修改docker run时要运行的内容
构建和使用镜像 打开CMD，CD到这个Dockerfile保存的目录下 docker build -t streamlit_winotmk:latest . 点不要落下
...</p></div><footer class=entry-footer>1 min&nbsp;·&nbsp;109 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to 用容器来运行streamlit" href=http://localhost:12371/posts/240724_%E7%94%A8%E5%AE%B9%E5%99%A8%E6%9D%A5%E8%BF%90%E8%A1%8Cstreamlit/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>给docker容器内配置中文环境(minecraft开服相关)</h2></header><div class=entry-content><p>最近找到个整合包（因为懒得一个个翻bbs https://www.bilibili.com/read/cv7403697/?spm_id_from=333.999.collection.opus.click 这包里的mod和之前自己开的服务器高度相似，太棒啦，从1.7.10直升1.12.2，基本还都是熟悉的味道 才知道mcbbs已经无了，然后才可发现mc百科已经这么好用了，连接直连发布curseforge和github，省去搬运步骤，也蛮好的！ 服务端有了，想通过docker容器部署到我的群晖NAS上，DS720+扩容了根16G内存条放着也是放着
选取docker镜像 docker hub里有官方镜像，用的是这个，体积精简，只运行环境jre就够了 https://hub.docker.com/_/openjdk/tags?page=1&amp;page_size=&amp;name=8u342&amp;ordering= 所以直接
docker pull openjdk:8u342-jre-slim 然后直接这样运行就好了
docker run -it -d \
-p 25565:25565 \
-v E:\game\MC\1.12.2mohist_服务端:/mc \
-w /mc \
--name MC1122 \
openjdk:8u342-jre-slim \
java -Xms2G -Xmx8G -XX:+UseG1GC -XX:+AggressiveOpts -XX:+UseCompressedOops -jar Mohist-1.12.2-c950429-server.jar nogui 虽然长，但是总的来说挺简单，用openjdk:8u342-jre-slim镜像运行java命令罢了，但是！ 出现了一个人让人感觉不爽的小问题，服务端的log输出以及游戏内服务端来的输出都是英文的，这在之前直接windows运行时不是这样的，所以第一反应是语言环境问题 设置环境变量 在docker run的时候加上个参数-e LANG="zh_CN.UTF-8"，类似export LANG=zh_CN.UTF-8 确定环境变量生效了： 但没解决问题，反而似乎导致启动的时候不认识中文的mod文件名了
在查找这个之后：docker 容器设置中文环境 发现单纯设置LANG的变量不行，容器里就没有中文字符集的
查看已有语言 locale -a 安装中文环境 使用DockerFile的方式快速构建一个基础镜像，解决中文环境问题 所以安装中文环境的命令可以是：
apt-get install -y language-pack-zh-hans 但这样不行！因为这个是ubuntu的命令，查看我的docker镜像的信息发现是以debian基底的 看到:Debian系统安装中文包
dpkg-reconfigure locales 然后再选zh_CN.UTF-8，可行，但是集成到镜像里没那么好使，还好有别的方法
制作新镜像 参考：dockerfile文件中给debian设置中文支持
dockerfile FROM openjdk:8u342-jre-slim
RUN apt-get clean && apt-get update && apt-get install -y locales && localedef -c -f UTF-8 -i zh_CN zh_CN.utf8
WORKDIR /mc
ENV LANG zh_CN.UTF-8 保存为dockerfile文件然后
...</p></div><footer class=entry-footer>1 min&nbsp;·&nbsp;185 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to 给docker容器内配置中文环境(minecraft开服相关)" href=http://localhost:12371/posts/240815_%E7%BB%99docker%E5%AE%B9%E5%99%A8%E5%86%85%E9%85%8D%E7%BD%AE%E4%B8%AD%E6%96%87%E7%8E%AF%E5%A2%83/></a></article><footer class=page-footer><nav class=pagination><a class=next href=http://localhost:12371/tags/docker/page/2/>Next&nbsp;&nbsp;»</a></nav></footer></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:12371/>ExampleSite</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>